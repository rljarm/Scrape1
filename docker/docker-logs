/var/lib/docker/containers/*/*.log {
    daily
    rotate 7
    compress
    delaycompress
    missingok
    copytruncate
    dateext
    dateformat -%Y%m%d
    create 0644 root root
    size 50M
    maxsize 500M
    notifempty
    postrotate
        /usr/bin/docker system prune -f --volumes >/dev/null 2>&1 || true
    endscript
}

/app/logs/*.log {
    daily
    rotate 14
    compress
    delaycompress
    missingok
    copytruncate
    dateext
    dateformat -%Y%m%d
    create 0644 root root
    size 50M
    maxsize 500M
    notifempty
}

/var/log/nginx/*.log {
    daily
    rotate 14
    compress
    delaycompress
    missingok
    copytruncate
    dateext
    dateformat -%Y%m%d
    create 0644 www-data www-data
    size 50M
    maxsize 500M
    notifempty
    sharedscripts
    postrotate
        [ -f /var/run/nginx.pid ] && kill -USR1 $(cat /var/run/nginx.pid)
    endscript
}

/var/log/redis/*.log {
    weekly
    rotate 10
    compress
    delaycompress
    missingok
    notifempty
    create 0644 redis redis
    sharedscripts
    postrotate
        [ -f /var/run/redis/redis-server.pid ] && kill -USR1 $(cat /var/run/redis/redis-server.pid)
    endscript
}

/var/log/postgresql/*.log {
    weekly
    rotate 10
    compress
    delaycompress
    missingok
    notifempty
    create 0640 postgres postgres
    sharedscripts
    postrotate
        /usr/lib/postgresql/*/bin/pg_ctl reload
    endscript
}

/var/log/celery/*.log {
    daily
    rotate 7
    compress
    delaycompress
    missingok
    notifempty
    create 0640 root root
    sharedscripts
    postrotate
        pkill -f 'celery worker' -USR1 || true
    endscript
}
